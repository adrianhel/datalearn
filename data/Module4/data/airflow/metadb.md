## 4.5.3 База метаданных (Metadata Database)

### [Назад к Airflow ⤶](/data/Module4/data/airflow.md)

База метаданных содержит всю информацию о том, сколько _DAG_'ов есть в нашей системе и какие подключения настроены. БД 
логирует абсолютно все исполнения задач и их статусы. В зависимости от того, какой у нас _[Executor](executors.md)_,
могут использоваться разные БД.

### Основные таблицы
Таблицы _DAG_, где хранится вся информация о них: активных, неактивных, их расположении и вся метаинформация, 
которая доступна. **Airflow** хранит даже "удаленные" _DAG's_.  
Вторая по важности таблица — это таблица _Connection_, в которой хранятся объекты подключения.  
Также важными таблицами являются таблицы _task_instance_, в которых хранится информация обо всех запусках наших задач.  

### Connections и Variables
- **Connection** отвечает за хранение информации о подключениях к внешним системам.
- **Variables** — это глобальные переменные.

### Connections
Представляют собой конфигурационные параметры, которые позволяют установить соединение с внешними ресурсами, 
такими как базы данных, облачные сервисы, _API_ и другие системы. _Connections_ содержат информацию, необходимую 
для установки и аутентификации соединений с этими ресурсами.  

Каждое соединение в **Airflow** имеет уникальное имя и определённый тип, который соответствует типу ресурса, с которым 
устанавливается соединение. Использование _Connections_ позволяет избежать хранения конфиденциальной информации, 
такой как пароли, прямо в коде задач или _DAG_. Можно определить соединение в **Airflow** и ссылаться на него в задачах 
или _DAG_, чтобы получать доступ к необходимым ресурсам.

#### Пример создания соединения
Использовать _Connection_ можно несколькими способами. Можно создать соединение через веб-интерфейс **Airflow**, 
перейдя в раздел `Admin -> Connections`, или программно, используя _Connection API_.

_Connection_ может хранить все необходимые ключи для того, чтобы подключаться к базе данных или какому-либо веб-ресурсу. 
В этом случае мы передаем в параметры оператора идентификатор подключения. Идентификатором подключения является 
уникальное имя, которое мы задаем при создании этого объекта в интерфейсе.  

```python
create_view = ClickHouseOperator(
    task_id=...,
    sql=... ,                                 # SQL запрос, который нужно выполнить
    clickhouse_conn_id='clickhouse_default',  # ID подключения, настроенное в Airflow
    dag=dag,
)
```

### Variables
_Variables_ представляют собой глобальные переменные, которые хранят информацию которая редко меняется, к примеру 
ключи _API_, пути к конфигурационным файлам и др.  

_Variables_ могут содержать любые данные, такие как строки, числа, списки и даже сложные объекты в формате _JSON_. 
Их можно создать, изменить и удалить через веб-интерфейс **Airflow** или с использованием _API_.  

