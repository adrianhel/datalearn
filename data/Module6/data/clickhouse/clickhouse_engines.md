## 6.2.5 Установка ClickHouse

### [Назад к ClickHouse ⤶](/data/Module6/data/clickhouse.md)

В **ClickHouse** существует множество движков таблиц, которые можно классифицировать по следующим признакам:
- По способу хранения: **постоянные** и **временные** таблицы.  
- По назначению: **основные** (для хранения пользовательских данных), **вспомогательные** (для интеграции, агрегации, 
буферизации и т.п.).  
- По поддерживаемым операциям: **модифицируемые** (поддерживают `INSERT`, `UPDATE`, `DELETE`), **только для чтения** 
(например, `VIEW`, `EXTERNAL`).  

## Основные типы таблиц
### 1. MergeTree
**MergeTree** — основной и наиболее гибкий механизм хранения, обеспечивающий:  
- _Высокую скорость вставки данных._  
- _Поддержку партиционирования (разделение данных на независимые части по указанному ключу)._   
- _Поддержку сортировки по ключу (primary key)._  
- _Вторичные индексы (skipping indices)._  
- _Фоновую агрегацию и очистку данных._  

#### Производные движки  
- **ReplacingMergeTree** — хранит только одну актуальную версию строки по ключу замены.  
- **SummingMergeTree** — осуществляет агрегацию (суммирование) по выбранным колонкам при слиянии данных.  
- **AggregatingMergeTree** — поддерживает хранение агрегированных данных с пользовательскими агрегационными функциями.  
- **CollapsingMergeTree** — поддерживает логику хранения событий с парой флагов (например, для учета отмен).  
- **VersionedCollapsingMergeTree** — вариант **CollapsingMergeTree** с поддержкой версионности строк.  
- **GraphiteMergeTree** — специализирован для хранения временных рядов графит-данных.  

#### Пример создания таблицы MergeTree

```sql
CREATE TABLE visits
(
    UserID UInt64,
    VisitDate Date,
    Page String
)
ENGINE = MergeTree
PARTITION BY toYYYYMM(VisitDate)
ORDER BY (UserID, VisitDate);
```

### 2. Log и TinyLog
**Log** — простой движок, данные хранятся в порядке вставки, индексация отсутствует. Подходит для небольших объёмов 
данных или временных таблиц.  

**TinyLog** — аналогичен **Log**, но данные хранятся в одном файле на каждый столбец, что уменьшает количество файлов, 
но снижает производительность при большом количестве данных.  

#### Пример создания таблицы Log

```sql
CREATE TABLE simple_log
(
    EventID UInt32,
    EventTime DateTime
)
ENGINE = Log;
```

### 3. StripeLog
Движок, сочетающий черты **Log** и **MergeTree**, оптимизирован для пакетной вставки строк. Каждый пакет хранится 
в виде полосы _(stripe)_.  

#### Пример создания таблицы StripeLog

```sql
CREATE TABLE stripe_log_example
(
    id UInt32,
    value String
)
ENGINE = StripeLog;
```

### 4. Memory
Данные хранятся только в оперативной памяти, что обеспечивает максимальную скорость операций, однако при перезапуске 
**ClickHouse** данные теряются. Используется для временных или промежуточных таблиц.  

#### Пример создания таблицы Memory

```sql
CREATE TABLE memory_table
(
    id UInt32,
    value String
)
ENGINE = Memory;
```

### 5. Null
Движок-пустышка, при вставке данных в такую таблицу они игнорируются, а при запросе результат всегда пустой. 
Используется для тестирования и отладки.  

#### Пример создания таблицы Null

```sql
CREATE TABLE null_table
(
    id UInt32
)
ENGINE = Null;
```

### 6. Buffer
Промежуточный буфер между источником данных и основной таблицей. Данные временно накапливаются в памяти, а затем 
автоматически сбрасываются в основную таблицу по определённым условиям (например, по времени или объёму).  

#### Пример создания таблицы Buffer

```sql
CREATE TABLE buffer_table
(
    id UInt32,
    value String
)
ENGINE = Buffer(default, main_table, 16, 10, 60, 10000, 100000, 1000000, 10000000);
```

### 7. External (File, URL, JDBC, ODBC)
- **File** — чтение и запись данных из файлов в различных форматах (*CSV*, *TSV*, *Parquet* и др.).  
- **URL** — данные читаются по *HTTP/HTTPS*-запросу.  
- **JDBC/ODBC** — интеграция с внешними СУБД через соответствующие протоколы.  

#### Пример создания таблицы External

```sql
CREATE TABLE file_table
(
    id UInt32,
    value String
)
ENGINE = File(CSV, '/var/lib/clickhouse/user_files/data.csv');
```

### 8. Distributed
Движок для организации распределённого хранения и обработки данных. Позволяет прозрачно обращаться к таблицам, 
физически размещённым на других серверах **ClickHouse**, обеспечивая масштабируемость и отказоустойчивость.  

#### Пример создания таблицы Distributed

```sql
CREATE TABLE dist_table
(
    id UInt32,
    value String
)
ENGINE = Distributed('cluster_name', 'default', 'local_table', rand());
```

### 9. View (Материализованные и обычные)
**VIEW** — виртуальная таблица, результат выполнения запроса `SELECT`. Данные не хранятся физически.  
**MATERIALIZED VIEW** — материализованное представление, физически сохраняющее результаты запроса, с автоматическим 
обновлением при изменении исходных данных.  

#### Пример создания таблицы View

```sql
CREATE MATERIALIZED VIEW mv_example
ENGINE = MergeTree
ORDER BY id
AS
SELECT id, count() as cnt
FROM main_table
GROUP BY id;
```